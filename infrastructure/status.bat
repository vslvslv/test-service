@echo off
REM ============================================================================
REM Test Service Infrastructure - Status Check (Windows)
REM ============================================================================

echo.
echo ??????????????????????????????????????????????????????????????????
echo ?         Test Service - Infrastructure Status                  ?
echo ??????????????????????????????????????????????????????????????????
echo.

REM Check Docker
echo [Docker Status]
echo ????????????????????????????????????????????????????????????????
docker info >nul 2>&1
if %errorlevel% equ 0 (
    echo ? Docker is running
) else (
    echo ? Docker is not running
    goto :end
)
echo.

REM Check containers
echo [Container Status]
echo ????????????????????????????????????????????????????????????????
docker ps --filter "name=testservice" --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"
echo.

REM Detailed health checks
echo [Health Checks]
echo ????????????????????????????????????????????????????????????????

REM MongoDB
docker ps | findstr "testservice-mongodb" >nul 2>&1
if %errorlevel% equ 0 (
    echo ? MongoDB: Running
    docker inspect --format "   Health: {{.State.Health.Status}}" testservice-mongodb 2>nul
    echo    Connection: mongodb://admin:password123@localhost:27017/TestServiceDb
) else (
    echo ? MongoDB: Not running
)
echo.

REM RabbitMQ
docker ps | findstr "testservice-rabbitmq" >nul 2>&1
if %errorlevel% equ 0 (
    echo ? RabbitMQ: Running
    docker inspect --format "   Health: {{.State.Health.Status}}" testservice-rabbitmq 2>nul
    echo    AMQP: localhost:5672
    echo    Management: http://localhost:15672 ^(guest/guest^)
) else (
    echo ? RabbitMQ: Not running
)
echo.

REM Volume status
echo [Volume Status]
echo ????????????????????????????????????????????????????????????????
docker volume ls --filter "name=testservice" --format "table {{.Name}}\t{{.Driver}}\t{{.Scope}}"
echo.

REM Network status
echo [Network Status]
echo ????????????????????????????????????????????????????????????????
docker network ls --filter "name=testservice" --format "table {{.Name}}\t{{.Driver}}\t{{.Scope}}"
echo.

:end
pause
