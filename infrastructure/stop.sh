#!/bin/bash

# ============================================================================
# Test Service Infrastructure - Stop Script (Linux/macOS)
# ============================================================================

GREEN='\033[0;32m'
RED='\033[0;31m'
NC='\033[0m'

echo ""
echo "??????????????????????????????????????????????????????????????????"
echo "?         Test Service - Stopping Infrastructure                ?"
echo "??????????????????????????????????????????????????????????????????"
echo ""

# Determine compose command
if command -v docker-compose &> /dev/null; then
    COMPOSE_CMD="docker-compose"
else
    COMPOSE_CMD="docker compose"
fi

echo "Stopping containers..."
$COMPOSE_CMD -f infrastructure/docker-compose.yml down

if [ $? -eq 0 ]; then
    echo -e "${GREEN}? Infrastructure stopped successfully${NC}"
else
    echo -e "${RED}? Failed to stop infrastructure${NC}"
    echo ""
    echo "Try manually:"
    echo "  docker stop testservice-mongodb testservice-rabbitmq"
    echo "  docker rm testservice-mongodb testservice-rabbitmq"
fi

echo ""
echo "To remove data volumes as well:"
echo "  $COMPOSE_CMD -f infrastructure/docker-compose.yml down -v"
echo ""
